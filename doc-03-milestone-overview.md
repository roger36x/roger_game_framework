# 文档三：里程碑路线图

> 本文档是粗略的里程碑规划。每个里程碑的详细规格会在前一个里程碑完成后再制定，以便根据实际经验调整。

---

## 总体原则

- 每个里程碑有明确的验收标准，完成即推进
- 里程碑之间允许重构，但不鼓励提前过度设计
- 优先验证技术风险最高的部分（渲染、性能）
- 游戏设计决策在独立的会话中推进，本路线图只涉及技术

---

## Milestone 1：最小原型 ✦ 当前

**目标：** 验证技术链路

- 等距瓦片网格渲染（20×20）
- 角色移动 + 镜头跟随
- 帧率稳定 60 FPS

**验证的技术风险：** FNA 在 macOS 上是否可用、等距渲染是否可行、协作模式是否成立

---

## Milestone 2：深度排序与多层建筑

**目标：** 解决等距渲染中最核心的难题——遮挡关系

- 引入"高度"概念：瓦片可以有不同的 Z 层级（地面、一楼、二楼）
- 放置几个简单的立体方块（代表建筑/墙壁）
- 实现正确的画家算法深度排序：角色可以走到方块前面/后面，遮挡关系自动正确
- 角色在不同高度层之间的显示处理

**验证的技术风险：** 深度排序算法的正确性和性能、多层建筑的数据结构

---

## Milestone 3：地图分块与流式加载

**目标：** 从固定小地图扩展到可无限延伸的大地图

- 地图按 chunk 组织（如 32×32 瓦片为一个 chunk）
- 只渲染和更新镜头可见范围内的 chunk
- chunk 的懒加载和卸载
- 测试：生成一个 200×200 的程序化地图，验证性能

**验证的技术风险：** 大规模瓦片的渲染性能、内存管理、chunk 边界处理

---

## Milestone 4：光照系统

**目标：** 实现基本的 2D 光照，区分室内外

- 全局环境光（模拟日夜）
- 点光源（火把、手电筒）
- 遮光：墙壁应阻挡光线传播
- 室内/室外区域的光照差异

**验证的技术风险：** 2D 光照的性能开销、阴影投射算法、与等距渲染的兼容性

---

## Milestone 5：实体交互框架

**目标：** 建立游戏对象之间的通用交互机制

- 引入 ECS 或类 ECS 架构（根据此时积累的经验选择方案）
- 定义实体（Entity）：角色、物品、家具、门等
- 定义交互（Interaction）：开门、拾取物品、推动家具
- 规则一致性：所有实体共享同一套交互规则

**验证的技术风险：** 架构选型、交互系统的可扩展性

---

## Milestone 6：天气与粒子

**目标：** 添加环境氛围层

- 雨、雪粒子效果
- 雾效
- 天气对游戏世界的影响（如地面变湿）
- 粒子系统的性能

---

## Milestone 7：音频系统

**目标：** 空间化音频、环境音

- 利用 FNA 的 FAudio 后端
- 空间音效（声音随距离衰减、方向感）
- 环境音循环（风声、雨声、僵尸远处的声音）
- 脚步声随地面材质变化

---

## Milestone 8：Lua 脚本绑定

**目标：** 暴露游戏逻辑给 Lua，为 mod 支持打基础

- 嵌入 Lua 运行时（MoonSharp 或 KeraLua）
- 定义 Lua 可访问的 API 表面
- 数据驱动的实体定义（从 Lua 脚本加载物品/配方/规则）

---

## Milestone 9：网络与多人

**目标：** 基础的客户端-服务器多人支持

- 这是最大的技术挑战之一，放在后面是有意为之
- 详细方案待前序里程碑完成后设计

---

## 调整机制

- 每完成一个里程碑，回顾并决定下一个里程碑是否需要调整顺序
- 如果某个里程碑在实施中暴露了架构问题，允许插入一个"重构里程碑"
- 游戏设计侧的决策可能会影响技术里程碑的优先级——两条线保持同步但不互相阻塞

---

*本文档为 v0.1，随项目推进持续更新。*
